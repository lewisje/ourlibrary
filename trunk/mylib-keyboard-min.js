var API,E,D,global=this;if(API&&API.attachListener&&Function.prototype.apply){(function(){var C=API.attachListener;var J=API.cancelDefault;var I=[];var G=[];var B;var A;var H={"63232":38,"63233":40,"63234":37,"63235":39,"63236":112,"63237":113,"63238":114,"63239":115,"63240":116,"63241":117,"63242":118,"63243":119,"63244":120,"63245":121,"63246":122,"63247":123,"63273":36,"63275":35,"63276":33,"63277":34};var F=function(N,W){var Q=W.onchar;var P=W.onkey;var L=W.onshortcutchar;var S=W.onnavkeypress;var M=W.callbackContext;var O=W.suppressControlKeyAutoRepeat;var T,V=0,U,K=0;C(N,"keypress",function(Z){var X,a,Y;if(!Z){Z=(((this.ownerDocument&&this.ownerDocument.parentWindow)||this.parentWindow)||global.window).event}a=Z.which;Y=Z.keyCode;X=typeof a=="number"?a:Y;if(Z.charCode===0&&X!=8&&X!=13){X=0}I[X]=true;if(X>31||X==13||X==8){if(L&&(Z.ctrlKey||Z.metaKey)&&(Z.ctrlKey!==Z.metaKey)&&!Z.altKey&&!Z.shiftKey){A=true;L.apply(M||this,[Z,(X>96&&X<123)?X-32:X]);return }if(!Z.ctrlKey&&!Z.altKey&&!Z.metaKey){if(T!=X||(X!=35&&X!=36&&X!=45&&X!=46)){if(Q.apply(M||this,[Z,X])===false){return J(Z)}return }}}else{if(!X&&!O){if(U==Y){K++}if(typeof B=="undefined"){if(V){B=K?"both":"down"}else{if(K){B="press"}}}if(B=="press"&&K>1){P.apply(M||this,[Z,Y])}U=Y;if(Y>36&&Y<41||(Y==33||Y==34)||Y==27){if(S){if(S.apply(M||this,[Z,Y])===false){return J(Z)}}}}}});var R=function(b){var Y,a,X;if(!b){b=(((this.ownerDocument&&this.ownerDocument.parentWindow)||this.parentWindow)||global.window).event}Y=typeof b.which=="number"?b.which:b.keyCode;Y=H[Y]||Y;if(b.type=="keyup"){if(Y==8&&!I[8]||Y==13&&!I[13]){Q.apply(M||this,[b,Y])}else{if(!b.shiftKey&&!b.ctrlKey&&!b.metaKey&&((Y==189&&!I[45])||(Y==190&&!I[46]))){Q.apply(M||this,[b,Y-144])}else{if(!A&&(b.ctrlKey||b.metaKey)&&(b.ctrlKey!==b.metaKey)&&(Y>47&&Y<91||Y==13)&&!b.altKey&&!b.shiftKey){L.apply(M||this,[b,Y])}}}if(G[Y]){a=new Date().getTime()-G[Y]}}else{var Z=new Date().getTime();if(O){if(G[Y]){return }}else{if(T===Y&&(Z-G[Y]<500)){V++}}if(B=="press"){K=0}if(T!==Y||!V){G[Y]=Z}T=Y}if(!V||B!="press"||b.type=="keyup"){X=P.apply(M||this,[b,Y,a])}if(b.type=="keyup"){G[Y]=T=U=V=K=0}if(X===false){return J(b)}};C(N,"keyup",R);C(N,"keydown",R);N=null};API.attachKeyboardListeners=F;if(E&&E.prototype){E.prototype.onKeyboard=function(K){var L=this.element();F(L,K)}}if(D&&D.prototype){D.prototype.onKeyboard=function(K){var L=this.node();F(L,K)}}})()}